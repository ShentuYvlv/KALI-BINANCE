[跳到主要内容](https://developers.binance.com/docs/zh-CN/derivatives/usds-margined-futures/websocket-market-streams/How-to-manage-a-local-order-book-correctly#__docusaurus_skipToContent_fallback)
[![Binance Logo](https://developers.binance.com/docs/zh-CN/img/logo.svg)](https://developers.binance.com/en)
产品▼
搜索`⌘``K`
当前全站
[](https://developers.binance.com/docs/zh-CN/derivatives/usds-margined-futures/websocket-market-streams/How-to-manage-a-local-order-book-correctly)
  * [English](https://developers.binance.com/docs/derivatives/usds-margined-futures/websocket-market-streams/How-to-manage-a-local-order-book-correctly)
  * [简体中文](https://developers.binance.com/docs/zh-CN/derivatives/usds-margined-futures/websocket-market-streams/How-to-manage-a-local-order-book-correctly)


衍生品交易
  * [更新日志](https://developers.binance.com/docs/zh-CN/derivatives/change-log)
  * [概述](https://developers.binance.com/docs/zh-CN/derivatives/Introduction)
  * [快速开始](https://developers.binance.com/docs/zh-CN/derivatives/quick-start)
  * [U本位合约](https://developers.binance.com/docs/zh-CN/derivatives/usds-margined-futures/websocket-market-streams/How-to-manage-a-local-order-book-correctly)
    * [基本信息](https://developers.binance.com/docs/zh-CN/derivatives/usds-margined-futures/general-info)
    * [WebSocket API基本信息](https://developers.binance.com/docs/zh-CN/derivatives/usds-margined-futures/websocket-api-general-info)
    * [通用枚举定义](https://developers.binance.com/docs/zh-CN/derivatives/usds-margined-futures/common-definition)
    * [行情接口](https://developers.binance.com/docs/zh-CN/derivatives/usds-margined-futures/websocket-market-streams/How-to-manage-a-local-order-book-correctly)
    * [交易接口](https://developers.binance.com/docs/zh-CN/derivatives/usds-margined-futures/websocket-market-streams/How-to-manage-a-local-order-book-correctly)
    * [Websocket行情推送](https://developers.binance.com/docs/zh-CN/derivatives/usds-margined-futures/websocket-market-streams/How-to-manage-a-local-order-book-correctly)
      * [市场数据连接](https://developers.binance.com/docs/zh-CN/derivatives/usds-margined-futures/websocket-market-streams)
      * [实时订阅/取消数据流](https://developers.binance.com/docs/zh-CN/derivatives/usds-margined-futures/websocket-market-streams/Live-Subscribing-Unsubscribing-to-streams)
      * [归集交易](https://developers.binance.com/docs/zh-CN/derivatives/usds-margined-futures/websocket-market-streams/Aggregate-Trade-Streams)
      * [最新标记价格](https://developers.binance.com/docs/zh-CN/derivatives/usds-margined-futures/websocket-market-streams/Mark-Price-Stream)
      * [全市场最新标记价格](https://developers.binance.com/docs/zh-CN/derivatives/usds-margined-futures/websocket-market-streams/Mark-Price-Stream-for-All-market)
      * [K线](https://developers.binance.com/docs/zh-CN/derivatives/usds-margined-futures/websocket-market-streams/Kline-Candlestick-Streams)
      * [连续合约 K 线](https://developers.binance.com/docs/zh-CN/derivatives/usds-margined-futures/websocket-market-streams/Continuous-Contract-Kline-Candlestick-Streams)
      * [按Symbol的精简 Ticker](https://developers.binance.com/docs/zh-CN/derivatives/usds-margined-futures/websocket-market-streams/Individual-Symbol-Mini-Ticker-Stream)
      * [全市场的完整Ticker](https://developers.binance.com/docs/zh-CN/derivatives/usds-margined-futures/websocket-market-streams/All-Market-Tickers-Streams)
      * [按 Symbol 的完整 Ticker](https://developers.binance.com/docs/zh-CN/derivatives/usds-margined-futures/websocket-market-streams/Individual-Symbol-Ticker-Streams)
      * [全市场的精简Ticker](https://developers.binance.com/docs/zh-CN/derivatives/usds-margined-futures/websocket-market-streams/All-Market-Mini-Tickers-Stream)
      * [按 Symbol 的最优挂单信息](https://developers.binance.com/docs/zh-CN/derivatives/usds-margined-futures/websocket-market-streams/Individual-Symbol-Book-Ticker-Streams)
      * [全市场最优挂单信息](https://developers.binance.com/docs/zh-CN/derivatives/usds-margined-futures/websocket-market-streams/All-Book-Tickers-Stream)
      * [强平订单](https://developers.binance.com/docs/zh-CN/derivatives/usds-margined-futures/websocket-market-streams/Liquidation-Order-Streams)
      * [全市场强平订单](https://developers.binance.com/docs/zh-CN/derivatives/usds-margined-futures/websocket-market-streams/All-Market-Liquidation-Order-Streams)
      * [有限档深度信息](https://developers.binance.com/docs/zh-CN/derivatives/usds-margined-futures/websocket-market-streams/Partial-Book-Depth-Streams)
      * [增量深度信息](https://developers.binance.com/docs/zh-CN/derivatives/usds-margined-futures/websocket-market-streams/Diff-Book-Depth-Streams)
      * [RPI增量深度信息](https://developers.binance.com/docs/zh-CN/derivatives/usds-margined-futures/websocket-market-streams/Diff-Book-Depth-Streams-RPI)
      * [如何正确在本地维护一个 orderbook 副本](https://developers.binance.com/docs/zh-CN/derivatives/usds-margined-futures/websocket-market-streams/How-to-manage-a-local-order-book-correctly)
      * [综合指数交易对信息流](https://developers.binance.com/docs/zh-CN/derivatives/usds-margined-futures/websocket-market-streams/Composite-Index-Symbol-Information-Streams)
      * [多资产模式资产汇率指数](https://developers.binance.com/docs/zh-CN/derivatives/usds-margined-futures/websocket-market-streams/Contract-Info-Stream)
      * [交易对信息信息流](https://developers.binance.com/docs/zh-CN/derivatives/usds-margined-futures/websocket-market-streams/Multi-Assets-Mode-Asset-Index)
      * [当前交易时段](https://developers.binance.com/docs/zh-CN/derivatives/usds-margined-futures/websocket-market-streams/Trading-Session-Stream)
    * [Websocket账户信息推送](https://developers.binance.com/docs/zh-CN/derivatives/usds-margined-futures/websocket-market-streams/How-to-manage-a-local-order-book-correctly)
    * [账户接口](https://developers.binance.com/docs/zh-CN/derivatives/usds-margined-futures/websocket-market-streams/How-to-manage-a-local-order-book-correctly)
    * [合约钱包闪兑](https://developers.binance.com/docs/zh-CN/derivatives/usds-margined-futures/websocket-market-streams/How-to-manage-a-local-order-book-correctly)
    * [经典统一账户接口](https://developers.binance.com/docs/zh-CN/derivatives/usds-margined-futures/websocket-market-streams/How-to-manage-a-local-order-book-correctly)
    * [常见问题](https://developers.binance.com/docs/zh-CN/derivatives/usds-margined-futures/websocket-market-streams/How-to-manage-a-local-order-book-correctly)
    * [错误代码](https://developers.binance.com/docs/zh-CN/derivatives/usds-margined-futures/error-code)
  * [币本位合约](https://developers.binance.com/docs/zh-CN/derivatives/usds-margined-futures/websocket-market-streams/How-to-manage-a-local-order-book-correctly)
  * [统一账户](https://developers.binance.com/docs/zh-CN/derivatives/usds-margined-futures/websocket-market-streams/How-to-manage-a-local-order-book-correctly)
  * [统一账户专业版](https://developers.binance.com/docs/zh-CN/derivatives/usds-margined-futures/websocket-market-streams/How-to-manage-a-local-order-book-correctly)
  * [期权](https://developers.binance.com/docs/zh-CN/derivatives/usds-margined-futures/websocket-market-streams/How-to-manage-a-local-order-book-correctly)


  * [](https://developers.binance.com/docs/zh-CN/)
  * U本位合约
  * Websocket行情推送
  * 如何正确在本地维护一个 orderbook 副本


# 如何正确在本地维护一个orderbook副本
  1. 订阅 **wss://fstream.binance.com/stream?streams=btcusdt@depth**
  2. 开始缓存收到的更新。同一个价位，后收到的更新覆盖前面的。
  3. 访问Rest接口 **[https://fapi.binance.com/fapi/v1/depth?symbol=BTCUSDT&limit=1000**获得一个1000档的深度快照](https://fapi.binance.com/fapi/v1/depth?symbol=BTCUSDT&limit=1000**%E8%8E%B7%E5%BE%97%E4%B8%80%E4%B8%AA1000%E6%A1%A3%E7%9A%84%E6%B7%B1%E5%BA%A6%E5%BF%AB%E7%85%A7)
  4. 将目前缓存到的信息中`u`< 步骤3中获取到的快照中的`lastUpdateId`的部分丢弃(丢弃更早的信息，已经过期)。
  5. 将深度快照中的内容更新到本地orderbook副本中，并从websocket接收到的第一个`U` `<= ``lastUpdateId` **且** `u` >`= ``lastUpdateId` 的event开始继续更新本地副本。


  * U = 来自 WebSocket 流的 firstUpdateId（第一个更新 ID）。
  * u = 来自 WebSocket 流的 finalUpdateId（最后一个更新 ID）。
  * lastUpdateId = 你从 REST 深度快照中获取的 更新 ID。


  1. 每一个新event的`pu`应该等于上一个event的`u`，否则可能出现了丢包，请从step3重新进行初始化。
  2. 每一个event中的挂单量代表这个价格目前的挂单量**绝对值** ，而不是相对变化。
  3. 如果某个价格对应的挂单量为0，表示该价位的挂单已经撤单或者被吃，应该移除这个价位。


[上一页 RPI增量深度信息](https://developers.binance.com/docs/zh-CN/derivatives/usds-margined-futures/websocket-market-streams/Diff-Book-Depth-Streams-RPI)[下一页 综合指数交易对信息流](https://developers.binance.com/docs/zh-CN/derivatives/usds-margined-futures/websocket-market-streams/Composite-Index-Symbol-Information-Streams)
Copyright © 2026 Binance.
